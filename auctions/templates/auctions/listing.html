{% extends "auctions/layout.html" %}

{% block title %}
{{listing.title}}
{%endblock %} 

{% block body %}
<div id="container">
  <div class="container-1 mt-4">
    <h2><i>{{ listing.title }}</i></h2>
    <hr class="rule" />
    <div class="listing-items-container">
      <div class="listing-section-1">
        <div class="listing-item-image">
          <img src="{{ listing.image_url }}" />
        </div>
        <div class="listing-item-description">
          <h3>Item overview</h3>
          <hr class="rule" />
          <div class="l-description">
            <h4>Description</h4>
            <p>{{ listing.description }}</p>
          </div>
        </div>
      </div>
      <div class="item-2">
        <div>
          <div>
            <a
              href="{% url 'auctions:listing page' listing.id %}"
              style="color: black"
            >
              <h3><i>{{ listing.title }}</i></h3>
            </a>
            <i>by: {{ listing.created_by }}</i>
            <p>Created: {{ listing.created_on }}</p>
            <p>
              <b>Est: </b>${{ listing.estimated_price_min }} USD - {{listing.estimated_price_max }} USD
            </p>
            <p>${{ listing.starting_bid_price }} USD</p>
           {% if listing.is_active %}
           <span class="badge bg-success px-3 py-2">
            <i class="bi bi-circle-fill me-1"></i> Auction is Live
           </span>
           {% else %}
           <span class="badge bg-danger px-3 py-2">
            <i class="bi bi-x-circle-fill me-1"></i> Auction Closed
           </span>
           {% endif %}
           <p></p>
          </div>
          <div>
            {% if user.is_authenticated %}
            {% if listing.is_active %}
            <h3>Current price: ${{ listing.starting_bid_price }} USD</h3>
            <p><strong>{{ listing.bids.count }}</strong> current bids</p>
            <form action="{% url 'auctions:bid' listing.id %}" method="post">
              {% csrf_token %}
              <div class="form-floating mb-3">
                <input
                  type="number"
                  step="0.01"
                  name="bid"
                  id="bid"
                  class="form-control"
                  placeholder="Enter your bid"
                  required
                />
              </div>
              <button type="submit" class="login-btn">Place bid</button>
            </form>

            {% endif %} {% else %}
            <p class="mt-3 p-3 bg-warning-subtle border rounded text-muted">
                <i class="bi bi-box-arrow-in-right me-1 text-warning"></i>
                <a href="{% url 'auctions:login' %}" style="color: #cc5500;" class="fw-semibold text-warning text-decoration-none" style="color: black;">
                    Log in</a> to place a bid.
            </p>
            {% endif %} {% if messages %} 
            {% for message in messages %}
            <div>{{ message }}</div>
            {% endfor %} {% endif %}
          </div>
          {% if user.is_authenticated %}
          {% if not listing.is_active %}
          {% if is_winner %}
          <div class="alert alert-success d-flex align-items-center" role="alert">
            <i class="bi bi-trophy-fill me-2" style="font-size: 1.5rem;"></i>
          <div>
            <strong>Congratulations!</strong> You won the auction!
          </div>
          </div>
          {% elif listing.auction_winner %}
          <div class="alert alert-info" role="alert">
            <strong>The Winner is:</strong> {{ listing.auction_winner.username }}
          </div>
          {% else %}
          <div class="alert alert-warning" role="alert">
            No bids were placed!
          </div>
          {% endif %}
          {% endif %}
          {% endif %}
          <div>
            {% if user.is_authenticated %}
            <form
              action="{% url 'auctions:watchlist toggle' listing.id %}"
              method="post"
            >
              {% csrf_token %}
              {% if user in listing.watchlist.all %}
              <button type="submit" class="submit-btn">
                Remove from Watchlist
              </button>
              {% else %}
              <button type="submit" class="submit-btn">Add to Watchlist</button>
              {% endif %}
            </form>
            {% else %}
            <p class="mt-3 p-3 bg-light border rounded text-muted">
                <i class="bi bi-box-arrow-in-right me-1 text-primary"></i>
                <a href="{% url 'auctions:login' %}" class="fw-semibold text-primary text-decoration-none">Log in</a> 
                to add this item to your wishlist.</p>
            {% endif %}
          </div>
          <div>
            {% if user.is_authenticated and user == listing.created_by and listing.is_active %}
            <form
              action="{% url 'auctions:close auction' listing.id %}"
              ,
              method="post">
              {% csrf_token %}
              <button type="submit" class="danger-btn btn-danger">
                Close Auction
              </button>
            </form>
            {% endif %}
          </div>
        </div>
        <div>
          <div>
            <div>
                <div class="card mb-3">
                    <div class="l-description card-header">
                        <h3>Comments</h3>
                    </div>
                    <div class="card-body comment-box">
                        
                        {% for comment in comments %}
                         <!-- Placeholder comments -->
                         <p><strong>Rono</strong> (Aug 09, 2025 18:15):<br>Really love the quality of this item!</p>
                         <p><strong>SarahM</strong> (Aug 09, 2025 18:27):<br>Arrived faster than expected, very satisfied.</p>
                         <p><strong>Admin</strong> (Aug 09, 2025 18:35):<br>The build feels premium and durable.</p>
                         <p><strong>Lily_88</strong> (Aug 09, 2025 18:49):<br>Great value for the price, would recommend.</p>
                         <p><strong>MikeP</strong> (Aug 09, 2025 19:02):<br>Exactly as described, works perfectly.</p>
                         <p><strong>ShopQueen</strong> (Aug 09, 2025 19:10):<br>Looks even better in person, thank you!</p>
                         <p><strong>AlexR</strong> (Aug 09, 2025 19:18):<br>Excellent customer service and product quality.</p>
                         <p><strong>NoraW</strong> (Aug 09, 2025 19:25):<br>Stylish and practical, Iâ€™m impressed.</p>
                         <p><strong>GamerX</strong> (Aug 09, 2025 19:33):<br>Perfect for my setup, fits like a glove.</p>
                         <p><strong>TravelBug</strong> (Aug 09, 2025 19:41):<br>Took it on my trip and it was super useful.</p>
                         <div style="border-bottom: 1px solid #ccc; margin-bottom: 10px">
                            <strong>{{ comment.user.username }}</strong> ({{comment.created|date:"M d, Y H:i" }}):<br />
                            <p>{{ comment.text }}</p>
                         </div>
                        {% empty %}
                        <p>No comments yet.</p>
                        {% endfor %}
                    </div>
                </div>
            <div>
              <form
                action="{% url 'auctions:comment' listing.id %}"
                method="post"
              >
                {% csrf_token %}
                <textarea class="form-control"
                  name="text"
                  style="width: 100%;"
                  placeholder="Add comment..."
                  required
                ></textarea>
                <button type="submit" class="login-btn">Comment</button>
              </form>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
